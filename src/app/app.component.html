<h1>
  {{title}}
</h1>

<div class="map-container">
  <div class="map">
    <mat-form-field>
      <input matInput id="address" type="text" placeholder="Rechercher une adresse..."
             #search [formControl]="searchControl">
    </mat-form-field>

    <agm-map [latitude]="mapCenter.lat" [longitude]="mapCenter.lng" [zoom]="zoom"
             [mapTypeControl]="true"
             [mapTypeControlOptions]="{mapTypeIds: ['roadmap', 'hybrid', 'satellite', 'terrain']}">
      <app-route [from]="routeOrigin" [to]="routeDestination" [waypoints]="waypoints" [keepMapZoomOnDisplay]="true">
      </app-route>

      <agm-marker *ngIf="searchAddress" [latitude]="searchAddress.lat" [longitude]="searchAddress.lng"
                  (markerClick)="select(searchAddress)">
      </agm-marker>

      <agm-marker *ngFor="let coworkerAddress of coworkerAddresses"
                  [latitude]="coworkerAddress.lat" [longitude]="coworkerAddress.lng"
                  (markerClick)="select(coworkerAddress)">
      </agm-marker>

      <agm-marker *ngFor="let address of otherAddresses; let i = index"
                  [latitude]="address.lat" [longitude]="address.lng"
                  [title]="address.title" [label]="'P'+(i+1)"
                  (markerClick)="select(address)">
      </agm-marker>
    </agm-map>
  </div>

  <div class="marker-details">
    <div *ngIf="routeOrigin">
      <h3>Point de départ</h3>
      <app-address-card [address]="routeOrigin"
                        [highlighted]="routeOrigin === selected"
                        [canSetAsOrigin]="false"
                        [canSetAsDestination]="false"
                        [canAddAsWaypoint]="false"
                        [canUnsetAsOrigin]="true"
                        [canUnsetAsDestination]="false"
                        [canRemoveAsWaypoint]="false"
                        (unsetAsOrigin)="resetOrigin()"
                        (centered)="centerMap(routeOrigin)">
      </app-address-card>
    </div>

    <div *ngIf="routeDestination">
      <h3>Arrivée</h3>
      <app-address-card [address]="routeDestination"
                        [highlighted]="routeDestination === selected"
                        [canSetAsOrigin]="false"
                        [canSetAsDestination]="false"
                        [canAddAsWaypoint]="false"
                        [canUnsetAsOrigin]="false"
                        [canUnsetAsDestination]="true"
                        [canRemoveAsWaypoint]="false"
                        (unsetAsDestination)="resetDestination()"
                        (centered)="centerMap(routeDestination)">
      </app-address-card>
    </div>

    <div *ngIf="selected">
      <h3>Sélection</h3>
      <app-address-card [address]="selected"
                        [canSetAsOrigin]="!alreadyOrigin && !alreadyDestination"
                        [canSetAsDestination]="!alreadyOrigin && !alreadyDestination"
                        [canAddAsWaypoint]="!alreadyWaypoint && !alreadyOrigin && !alreadyDestination"
                        [canUnsetAsOrigin]="alreadyOrigin"
                        [canUnsetAsDestination]="alreadyDestination"
                        [canRemoveAsWaypoint]="alreadyWaypoint"
                        (setAsOrigin)="displayRouteFrom(selected)"
                        (setAsDestination)="displayRouteTo(selected)"
                        (addedAsWaypoint)="addWaypoint(selected)"
                        (unsetAsOrigin)="resetOrigin()"
                        (unsetAsDestination)="resetDestination()"
                        (removedAsWaypoint)="removeWaypoint(selected)"
                        (centered)="centerMap(selected)">
      </app-address-card>
    </div>
  </div>
</div>

<div class="waypoint">
  <app-address-card *ngFor="let waypoint of waypoints" [address]="waypoint"
                    [canSetAsOrigin]="true"
                    [canSetAsDestination]="true"
                    [canAddAsWaypoint]="false"
                    [canUnsetAsOrigin]="false"
                    [canUnsetAsDestination]="false"
                    [canRemoveAsWaypoint]="true"
                    (setAsOrigin)="displayRouteFrom(waypoint)"
                    (setAsDestination)="displayRouteTo(waypoint)"
                    (addedAsWaypoint)="addWaypoint(waypoint)"
                    (unsetAsOrigin)="resetOrigin()"
                    (unsetAsDestination)="resetDestination()"
                    (removedAsWaypoint)="removeWaypoint(waypoint)"
                    (centered)="centerMap(waypoint)">
  </app-address-card>
</div>



